<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <title>EvalBest</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            background-color: #f0f2f5;
        }
        .header {
            background: linear-gradient(45deg, #2196F3, #00BCD4);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #29e8d8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .image-preview {
            max-width: 200px;
            margin-top: 10px;
        }

        /* Dropdown Button */
.dropbtn {
    background-color: transparent;
    color: white;
    padding: 10px;
    font-size: 24px;
    border: none;
    cursor: pointer;
    position: absolute;
    top: 20px;
    right: 20px;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
    display: none;
    position: absolute;
    top: 50px;
    right: 20px;
    background-color: #f9f9f9;
    min-width: 120px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {
    background-color: #f1f1f1;
}

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {
    display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {
    background-color: rgba(255, 255, 255, 0.1);
}
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --background-color: #f3f4f6;
            --text-color: #1f2937;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 2rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 2rem;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 1rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
        }

        .image-preview img {
            max-width: 200px;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #camera-container {
            margin: 1rem 0;
            text-align: center;
        }

        #camera-container video {
            width: 100%;
            max-width: 400px;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .required {
            color: #dc2626;
            margin-left: 0.25rem;
        }

    </style>
<body>
    <div class="header".header {
    background: linear-gradient(45deg, #2196F3, #00BCD4);
    color: white;
    padding: 20px;
    text-align: center;
    border-radius: 10px;
    margin-bottom: 20px;
    position: relative; /* Tambahkan ini */
}>


        <h1>EvalBest</h1>
        <h2>Evaluasi Belajar Santri</h2>
    </div>
    <!-- Dropdown Menu -->
    <div class="dropdown">
        <button class="dropbtn">â˜°</button>
        <div class="dropdown-content">
            <a href="https://i.postimg.cc/brMhVyzQ/jadwal-Mif.jpg" target="_blank">Jadwalku</a>
            <a href="https://miftahadm.github.io/daur/" target="_blank">Daur</a> 
            <a href="https://postimg.cc/gallery/3HnHGdk" target="_blank">KBM</a>           
            <a href="https://cekspp.netlify.app/" target="_blank">cekspp</a>          
            <a href="https://docs.google.com/forms/d/15f4lHbIGuvxvX-1dpzKTgO9m3ZpnV-48qaS4NqnJIxc/edit#responses" target="_blank">PSB25-online</a>
            <a href="https://docs.google.com/spreadsheets/d/1QwkcWSOemp6cwWxa7KTWndPngBKTduYV/edit?usp=sharing&ouid=106181527163403951983&rtpof=true&sd=true" target="_blank">PSB25-offline</a>            
            <a href="https://docs.google.com/spreadsheets/d/1Fe9BKdrQYZQCfsMnEKPtCK_GPaxoLNy_aZTc9DDFMio/edit?gid=0#gid=0" target="_blank">PSB-ADM</a>            
            <a href="https://miftahadm.github.io/ruangAdministrasi/" target="_blank">Ruang ADM</a>
            <a href="http://103.127.97.31/cbs/home#!" target="_blank">CBS</a> 
            <a href="https://pondok.pesantren.trubus.iman.madani-tech.com/index.php/login?redirect=C_Users" target="_blank">PanelCBS</a> 
            <a href="https://miftahadm.github.io/naqd/" target="_blank">EvalTeach</a>
            <a href="https://docs.google.com/document/d/1neKYUekyFhC0HzhGOaEcpLB_aPfeiR8d1eM0ysP5wNM/edit?usp=sharing">SertifB</a>
            <a href="https://docs.google.com/document/d/1Fl1LB-xWaW52tP0THZyZQ65zuwkUBJOF-_ExwhEXKe0/edit?usp=sharing">SertifH</a>            
        </div>
    </div>
</div>

    <div class="container">
        <div class="form-group">
            <label>Nama Guru:</label>
            <input type="text" id="namaGuru">
        </div>

        <div class="form-group">
            <label>Tanggal Mengajar:</label>
            <input type="date" id="tanggalMengajar">
        </div>

        <div class="form-group">
            <label>Mata Pelajaran:</label>
            <input type="text" id="mapel">
        </div>

        <div class="form-group">
            <label>Kelas:</label>
            <select id="kelas">
                <option value="5Bi">5Bi</option>
                <option value="5Ba">5Ba</option>
                <option value="5Ca">5Ca</option>
                <option value="6Ba">6Ba</option>
                <option value="6Ca">6Ca</option>
                <option value="6Bi">6Bi</option>
                <option value="6Ci">6Ci</option>
            </select>
        </div>

        <div class="form-group">
            <label>Tujuan Pembelajaran:</label>
            <textarea id="tujuanPembelajaran" rows="4"></textarea>
        </div>


        <div class="form-group">
            <label>Gambar</label>
            <input type="file" id="imageInput" accept="image/*" multiple style="display: none">
            <button class="btn" onclick="document.getElementById('imageInput').click()">Input Gambar</button>
            <button class="btn" onclick="openCamera()">Buka Kamera</button>
            <div id="imagePreview" class="image-preview"></div>
            <div id="camera-container"></div>
        </div>

        <div class="form-group">
            <label>Data Peserta Didik:</label>
            <input type="file" id="csvFile" accept=".csv">
            <button onclick="tambahPesertaDidik()">Tambah Peserta Didik</button>
        </div>

        <table id="nilaiTable">
                <tr>
                    <th>Nama Peserta Didik</th>
                    <th>Nilai</th>
                </tr>
            <tbody id="nilaiTableBody"></tbody>
        </table>

        <div style="margin-top: 20px;">
            <button onclick="generatePDF()">Generate PDF</button>
            <button onclick="generateNilaiPDF()">PDF Nilai Harian</button>
            <button onclick="generateSertifikat()">Sertifikat</button>
        </div>
    </div>

    <style>
    </style>

    <script>
        // Variabel global untuk menyimpan gambar
        let images = [];
        let videoStream = null;

        // Event listener untuk input gambar
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const files = e.target.files;
            handleImageFiles(files);
        });

        // Fungsi untuk menangani file gambar
        function handleImageFiles(files) {
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    images.push(e.target.result);
                    updateImagePreview();
                };
                reader.readAsDataURL(file);
            }
        }

        // Fungsi untuk membuka kamera
        function openCamera() {
            const container = document.getElementById('camera-container');
            
            // Bersihkan container kamera jika sudah ada
            container.innerHTML = '';
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    videoStream = stream;
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.autoplay = true;
                    
                    const captureBtn = document.createElement('button');
                    captureBtn.textContent = 'Ambil Foto';
                    captureBtn.className = 'btn';
                    
                    container.appendChild(video);
                    container.appendChild(captureBtn);
                    
                    captureBtn.onclick = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        images.push(canvas.toDataURL('image/jpeg'));
                        updateImagePreview();
                        
                        // Hentikan stream kamera
                        videoStream.getTracks().forEach(track => track.stop());
                        container.innerHTML = '';
                    };
                })
                .catch(function(err) {
                    alert('Error mengakses kamera: ' + err.message);
                });
        }

        // Fungsi untuk memperbarui preview gambar
        function updateImagePreview() {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            images.forEach((image, index) => {
                const img = document.createElement('img');
                img.src = image;
                preview.appendChild(img);
            });
        }

        // Fungsi untuk menghasilkan PDF
        function generatePDF() {
            const namaGuru = document.getElementById('namaGuru').value;
            const tanggalMengajar = document.getElementById('tanggalMengajar').value;
            const mapel = document.getElementById('mapel').value;
            const kelas = document.getElementById('kelas').value;

            // Validasi input
            if (!namaGuru || !tanggalMengajar || !mapel || !kelas) {
                alert('Mohon lengkapi semua field yang wajib diisi!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFontSize(16);
            doc.text('RENCANA PELAKSANAAN PEMBELAJARAN', 105, 20, { align: 'center' });

            // Informasi RPP
            doc.setFontSize(12);
            const info = [
                `Nama Guru: ${namaGuru}`,
                `Tanggal Mengajar: ${tanggalMengajar}`,
                `Mata Pelajaran: ${mapel}`,
                `Kelas: ${kelas}`
            ];

            info.forEach((text, index) => {
                doc.text(text, 20, 40 + (index * 10));
            });

            // Tambahkan gambar jika ada
            let yPos = 80;
            images.forEach((image, index) => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                doc.addImage(image, 'JPEG', 20, yPos, 170, 80);
                yPos += 90;
            });

            // Simpan PDF
            doc.save('rpp.pdf');
        }

        // Tambah peserta didik
        function tambahPesertaDidik() {
            const tbody = document.getElementById('nilaiTableBody');
            const row = tbody.insertRow();
            const cell1 = row.insertCell(0);
            const cell2 = row.insertCell(1);
            
            cell1.innerHTML = '<input type="text" placeholder="Nama Peserta Didik">';
            cell2.innerHTML = '<input type="number" placeholder="Nilai">';
        }

        // Generate PDF Nilai
function generateNilaiPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4'); // Format A4

    // Header PDF Nilai Harian
    doc.setFontSize(16);
    doc.text('DAFTAR NILAI HARIAN', 105, 20, { align: 'center' });

    // Informasi Dasar
    doc.setFontSize(12);
    doc.text(`Nama Guru: ${document.getElementById('namaGuru').value}`, 20, 40);
    doc.text(`Tanggal: ${document.getElementById('tanggalMengajar').value}`, 20, 50);
    doc.text(`Mata Pelajaran: ${document.getElementById('mapel').value}`, 20, 60);
    doc.text(`Kelas: ${document.getElementById('kelas').value}`, 20, 70);

    // Tabel Nilai
    doc.setFontSize(14);
    doc.text('Daftar Nilai Peserta Didik:', 20, 90);
    doc.setFontSize(12);

    const tbody = document.getElementById('nilaiTableBody');
    let y = 100; // Posisi awal untuk tabel nilai
    let totalNilai = 0; // Untuk menghitung total nilai
    let jumlahPeserta = 0; // Untuk menghitung jumlah peserta

    // Loop melalui setiap baris tabel nilai
    for (let i = 0; i < tbody.rows.length; i++) {
        const nama = tbody.rows[i].cells[0].querySelector('input').value;
        const nilai = parseFloat(tbody.rows[i].cells[1].querySelector('input').value);

        // Tambahkan nama dan nilai ke PDF
        doc.text(`${nama}: ${nilai}`, 20, y);
        y += 10;

        // Hitung total nilai dan jumlah peserta
        if (!isNaN(nilai)) {
            totalNilai += nilai;
            jumlahPeserta++;
        }

        // Jika konten melebihi batas halaman, tambahkan halaman baru
        if (y > 280) {
            doc.addPage();
            y = 20; // Reset posisi y untuk halaman baru
        }
    }

    // Hitung rata-rata nilai
    const rataRata = jumlahPeserta > 0 ? (totalNilai / jumlahPeserta).toFixed(2) : 0;

    // Tambahkan rata-rata nilai ke PDF
    doc.setFontSize(14);
    doc.text(`Rata-rata Nilai: ${rataRata}`, 20, y + 10);

    // Simpan PDF
    doc.save('nilai-harian.pdf');
}
        // Generate Sertifikat
        function generateSertifikat() {
            const { jsPDF } = window.jspdf;
            
            // Dapatkan nilai tertinggi dan terendah
            const nilai = Array.from(document.getElementById('nilaiTableBody').rows)
                .map(row => ({
                    nama: row.cells[0].querySelector('input').value,
                    nilai: parseInt(row.cells[1].querySelector('input').value)
                }))
                .sort((a, b) => b.nilai - a.nilai);

            // Generate sertifikat untuk nilai tertinggi
            const docTertinggi = new jsPDF();
            docTertinggi.setFontSize(24);
            docTertinggi.text('SERTIFIKAT PENGHARGAAN', 105, 50, { align: 'center' });
            docTertinggi.setFontSize(16);
            docTertinggi.text(`Diberikan kepada:`, 105, 70, { align: 'center' });
            docTertinggi.text(`${nilai[0].nama}`, 105, 80, { align: 'center' });
            docTertinggi.text(`Nilai: ${nilai[0].nilai}`, 105, 90, { align: 'center' });
            docTertinggi.text('Selamat atas prestasi cemerlang!', 105, 110, { align: 'center' });
            docTertinggi.save('sertifikat-tertinggi.pdf');

            // Generate sertifikat untuk 2 nilai terendah
            nilai.slice(-2).forEach((siswa, index) => {
                const docTerendah = new jsPDF();
                docTerendah.setFontSize(24);
                docTerendah.text('SERTIFIKAT SEMANGAT', 105, 50, { align: 'center' });
                docTerendah.setFontSize(16);
                docTerendah.text(`Diberikan kepada:`, 105, 70, { align: 'center' });
                docTerendah.text(`${siswa.nama}`, 105, 80, { align: 'center' });
                docTerendah.text(`Nilai: ${siswa.nilai}`, 105, 90, { align: 'center' });
                docTerendah.text('Terus semangat dan tingkatkan prestasimu!', 105, 110, { align: 'center' });
                docTerendah.save(`sertifikat-semangat-${index + 1}.pdf`);
            });
        }

        // CSV File Handler
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const csv = event.target.result;
                const rows = csv.split('\n');
                const tbody = document.getElementById('nilaiTableBody');
                tbody.innerHTML = '';
                
                rows.forEach(row => {
                    if (row.trim()) {
                        const tr = tbody.insertRow();
                        const cell1 = tr.insertCell(0);
                        const cell2 = tr.insertCell(1);
                        
                        cell1.innerHTML = `<input type="text" value="${row.trim()}" readonly>`;
                        cell2.innerHTML = '<input type="number" placeholder="Nilai">';
                    }
                });
            };
            
            reader.readAsText(file);
        });

    </script>
</body>
</head>
</html>
